"use strict";(()=>{var e={};e.id=3490,e.ids=[3490],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},42496:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{POST:()=>c});var s=r(49303),i=r(88716),n=r(60670),o=r(87070),u=r(42633),d=r(48645),l=r(57745),p=r(2310);async function c(e){try{let t;let{firebaseUid:r,email:a,name:s,image:i,authProvider:n}=await e.json();if(!a)return o.NextResponse.json({error:"Email is required"},{status:400});let c=await u.db.select().from(d.Users).where((0,l.eq)(d.Users.email,a)).limit(1);c.length>0?(t=c[0],"google"===n&&(await u.db.update(d.Users).set({name:s||t.name,image:i||t.image,firebaseUid:r,authProvider:n||"google",updatedAt:new Date}).where((0,l.eq)(d.Users.id,t.id)),t=(await u.db.select().from(d.Users).where((0,l.eq)(d.Users.id,t.id)).limit(1))[0])):t=(await u.db.insert(d.Users).values({email:a,name:s||a.split("@")[0],password:"",firebaseUid:r,authProvider:n||"google",image:i||null,balance:0,createdAt:new Date,updatedAt:new Date}).returning())[0];let m=(0,p.V3)({id:t.id,email:t.email,name:t.name}),g=o.NextResponse.json({user:{id:t.id,email:t.email,name:t.name,image:t.image},isNewUser:0===c.length});return g.cookies.set("auth_token",m,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:2592e3}),g}catch(e){return o.NextResponse.json({error:"Failed to sync user",details:e.message},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/firebase-sync/route",pathname:"/api/auth/firebase-sync",filename:"route",bundlePath:"app/api/auth/firebase-sync/route"},resolvedPagePath:"C:\\Users\\devan\\Downloads\\zero2hero-Waste-Management-System-master\\src\\app\\api\\auth\\firebase-sync\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:x}=m,w="/api/auth/firebase-sync/route";function y(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972,7917,2310],()=>r(42496));module.exports=a})();