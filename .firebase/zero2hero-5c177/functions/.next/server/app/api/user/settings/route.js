"use strict";(()=>{var e={};e.id=3884,e.ids=[3884],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},58789:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>U,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>d,PUT:()=>m});var n=r(49303),a=r(88716),i=r(60670),o=r(87070),l=r(95456),u=r(42633),c=r(48645),p=r(57745);async function d(e){try{let e=await (0,l.a)();if(!e)return o.NextResponse.json({error:"Unauthorized"},{status:401});let t=await u.db.select({publicProfileVisible:c.Users.publicProfileVisible,profileSearchable:c.Users.profileSearchable,showRealName:c.Users.showRealName,personalStatsVisible:c.Users.personalStatsVisible,dataSharing:c.Users.dataSharing,environmentalTracking:c.Users.environmentalTracking,collectionHistoryRetention:c.Users.collectionHistoryRetention}).from(c.Users).where((0,p.eq)(c.Users.id,e.id)).limit(1);if(0===t.length)return o.NextResponse.json({error:"User not found"},{status:404});return o.NextResponse.json(t[0])}catch(e){return o.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e){try{let t=await (0,l.a)();if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{publicProfileVisible:r,profileSearchable:s,showRealName:n,personalStatsVisible:a,dataSharing:i,environmentalTracking:d,collectionHistoryRetention:m}=await e.json();return await u.db.update(c.Users).set({publicProfileVisible:r??!0,profileSearchable:s??!0,showRealName:n??!1,personalStatsVisible:a??!0,dataSharing:i??"anonymous",environmentalTracking:d??!0,collectionHistoryRetention:m??"1year",updatedAt:new Date}).where((0,p.eq)(c.Users.id,t.id)),o.NextResponse.json({message:"Settings updated successfully"})}catch(e){return o.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/user/settings/route",pathname:"/api/user/settings",filename:"route",bundlePath:"app/api/user/settings/route"},resolvedPagePath:"C:\\Users\\devan\\Downloads\\zero2hero-Waste-Management-System-master\\src\\app\\api\\user\\settings\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:f}=h,U="/api/user/settings/route";function y(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},95456:(e,t,r)=>{r.d(t,{a:()=>l});var s=r(71615),n=r(42633),a=r(48645),i=r(57745),o=r(2310);async function l(){let e=(0,s.cookies)(),t=e.get("auth_token")?.value;if(!t)return null;try{let e=(0,o.WX)(t);if(!e||!e.id)return null;return(await n.db.select({id:a.Users.id,email:a.Users.email,name:a.Users.name}).from(a.Users).where((0,i.eq)(a.Users.id,e.id)).limit(1))[0]||null}catch(e){return null}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,7917,2310],()=>r(58789));module.exports=s})();