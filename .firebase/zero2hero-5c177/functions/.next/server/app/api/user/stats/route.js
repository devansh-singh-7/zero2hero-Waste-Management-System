"use strict";(()=>{var e={};e.id=2219,e.ids=[2219],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},70117:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>q,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>R,staticGenerationAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{GET:()=>g,dynamic:()=>x});var o=r(49303),n=r(88716),a=r(60670),u=r(87070),i=r(2310),c=r(42633),p=r(48645),d=r(60938),l=r(57745),m=r(62315);let x="force-dynamic";async function g(e){try{let e=await (0,i.I8)();if(!e?.user?.id)return u.NextResponse.json({error:"Authentication required"},{status:401});let t=Number(e.user.id);if(!t)return u.NextResponse.json({error:"Invalid user ID"},{status:400});let r=await c.db.select({count:(0,d.QX)()}).from(p.Reports).where((0,l.eq)(p.Reports.userId,t)),s=await c.db.select({count:(0,d.QX)()}).from(p.CollectedWastes).where((0,l.eq)(p.CollectedWastes.collectorId,t)),o=await c.db.select({total:(0,m.i6)`COALESCE(SUM(${p.Transactions.amount}), 0)`}).from(p.Transactions).where((0,l.eq)(p.Transactions.userId,t)),n=(await c.db.select({userId:p.Reports.userId,reportCount:(0,d.QX)()}).from(p.Reports).groupBy(p.Reports.userId).orderBy((0,m.i6)`count(*) DESC`)).findIndex(e=>e?.userId===t)+1,a=2*(r[0]?.count||0),x=.5*a,g={totalReports:r[0]?.count||0,totalEarnings:o[0]?.total||0,completedTasks:s[0]?.count||0,currentRank:n>0?n:null,wasteCollected:`${a} kg`,co2Saved:`${x.toFixed(1)} kg`};return u.NextResponse.json(g)}catch(e){return u.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/user/stats/route",pathname:"/api/user/stats",filename:"route",bundlePath:"app/api/user/stats/route"},resolvedPagePath:"C:\\Users\\devan\\Downloads\\zero2hero-Waste-Management-System-master\\src\\app\\api\\user\\stats\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:R}=h,q="/api/user/stats/route";function w(){return(0,a.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:v})}},60938:(e,t,r)=>{r.d(t,{QX:()=>o,Sm:()=>n});var s=r(62315);function o(e){return(0,s.i6)`count(${e||s.i6.raw("*")})`.mapWith(Number)}function n(e){return(0,s.i6)`sum(${e})`.mapWith(String)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,7917,2310],()=>r(70117));module.exports=s})();