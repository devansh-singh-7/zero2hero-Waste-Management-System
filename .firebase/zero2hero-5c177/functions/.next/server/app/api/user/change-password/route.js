"use strict";(()=>{var e={};e.id=7942,e.ids=[7942],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},55222:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>f,patchFetch:()=>j,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var t={};s.r(t),s.d(t,{POST:()=>w});var a=s(49303),n=s(88716),o=s(60670),i=s(87070),u=s(95456),d=s(42633),p=s(48645),c=s(57745),l=s(2310);async function w(e){try{let r=await (0,u.a)();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{currentPassword:s,newPassword:t}=await e.json();if(!s||!t)return i.NextResponse.json({error:"Current password and new password are required"},{status:400});if(t.length<6)return i.NextResponse.json({error:"New password must be at least 6 characters long"},{status:400});let a=await d.db.select({password:p.Users.password}).from(p.Users).where((0,c.eq)(p.Users.id,r.id)).limit(1);if(0===a.length)return i.NextResponse.json({error:"User not found"},{status:404});if(!await (0,l.Gv)(s,a[0].password))return i.NextResponse.json({error:"Current password is incorrect"},{status:400});let n=await (0,l.c_)(t);return await d.db.update(p.Users).set({password:n,updatedAt:new Date}).where((0,c.eq)(p.Users.id,r.id)),i.NextResponse.json({message:"Password changed successfully"})}catch(e){return i.NextResponse.json({error:"Internal server error"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/user/change-password/route",pathname:"/api/user/change-password",filename:"route",bundlePath:"app/api/user/change-password/route"},resolvedPagePath:"C:\\Users\\devan\\Downloads\\zero2hero-Waste-Management-System-master\\src\\app\\api\\user\\change-password\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:g}=m,f="/api/user/change-password/route";function j(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},95456:(e,r,s)=>{s.d(r,{a:()=>u});var t=s(71615),a=s(42633),n=s(48645),o=s(57745),i=s(2310);async function u(){let e=(0,t.cookies)(),r=e.get("auth_token")?.value;if(!r)return null;try{let e=(0,i.WX)(r);if(!e||!e.id)return null;return(await a.db.select({id:n.Users.id,email:n.Users.email,name:n.Users.name}).from(n.Users).where((0,o.eq)(n.Users.id,e.id)).limit(1))[0]||null}catch(e){return null}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[8948,5972,7917,2310],()=>s(55222));module.exports=t})();