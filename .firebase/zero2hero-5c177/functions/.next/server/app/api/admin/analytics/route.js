"use strict";(()=>{var e={};e.id=7777,e.ids=[7777],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49491:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>N,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{GET:()=>m,dynamic:()=>p});var l=a(49303),o=a(88716),s=a(60670),n=a(87070),i=a(42633),d=a(48645),u=a(60938),c=a(57745);let p="force-dynamic";async function m(e){try{if(!e.cookies.get("admin_session")?.value)return n.NextResponse.json({error:"Admin authentication required"},{status:401});let t=await i.db.select({count:(0,u.QX)()}).from(d.Users),a=await i.db.select({count:(0,u.QX)()}).from(d.Reports),r=await i.db.select().from(d.Reports),l=r.filter(e=>"pending"===e.status).length,o=r.filter(e=>"completed"===e.status).length,s=r.filter(e=>"in-progress"===e.status).length,p=0;try{let e=await i.db.select({total:(0,u.Sm)(d.Users.balance)}).from(d.Users);p=Number(e[0]?.total)||0}catch(e){try{let e=await i.db.select({total:(0,u.Sm)(d.Transactions.amount)}).from(d.Transactions).where((0,c.eq)(d.Transactions.type,"earned"));p=Number(e[0]?.total)||0}catch(e){p=0}}let m=new Date;m.setDate(m.getDate()-7);let f=await i.db.select({count:(0,u.QX)()}).from(d.Reports).where((0,c.eg)(d.Reports.createdAt,m)),N=await i.db.select({count:(0,u.QX)()}).from(d.Users).where((0,c.eg)(d.Users.createdAt,m)),_=new Date;_.setDate(_.getDate()-30);let h=await i.db.select({count:(0,u.QX)()}).from(d.Reports).where((0,c.eg)(d.Reports.createdAt,_)),g=await i.db.select({count:(0,u.QX)()}).from(d.Users).where((0,c.eg)(d.Users.createdAt,_)),w=await i.db.select({id:d.Users.id,name:d.Users.name,email:d.Users.email,balance:d.Users.balance}).from(d.Users).orderBy(d.Users.balance).limit(5),y=await i.db.select({id:d.Reports.id,type:d.Reports.wasteType,location:d.Reports.location,status:d.Reports.status,createdAt:d.Reports.createdAt,userId:d.Reports.userId,userName:d.Users.name}).from(d.Reports).leftJoin(d.Users,(0,c.eq)(d.Reports.userId,d.Users.id)).orderBy(d.Reports.createdAt).limit(10),b={overview:{totalUsers:Number(t[0]?.count)||0,totalReports:Number(a[0]?.count)||0,pendingTasks:l,completedTasks:o,inProgressTasks:s,totalTasks:r.length,totalTokensDistributed:p},recent:{reportsLastWeek:Number(f[0]?.count)||0,usersLastWeek:Number(N[0]?.count)||0,reportsLastMonth:Number(h[0]?.count)||0,usersLastMonth:Number(g[0]?.count)||0},topUsers:w.reverse(),recentActivity:y.reverse()};return n.NextResponse.json(b)}catch(e){return n.NextResponse.json({error:"Failed to fetch analytics"},{status:500})}}let f=new l.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"C:\\Users\\devan\\Downloads\\zero2hero-Waste-Management-System-master\\src\\app\\api\\admin\\analytics\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:N,staticGenerationAsyncStorage:_,serverHooks:h}=f,g="/api/admin/analytics/route";function w(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},42633:(e,t,a)=>{a.d(t,{db:()=>n});var r=a(17917),l=a(62237),o=a(48645);let s=(0,l.qn)("postgresql://neondb_owner:Devansh%4077@ep-weathered-waterfall-a16ci7i1-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require"),n=(0,r.tS)(s,{schema:o})},48645:(e,t,a)=>{a.r(t),a.d(t,{CollectedWastes:()=>f,Notifications:()=>N,Reports:()=>p,Rewards:()=>m,Transactions:()=>_,Users:()=>c,WasteCollectionTasks:()=>g,available_rewards:()=>h,collectedWaste:()=>L,notifications:()=>v,reports:()=>y,rewards:()=>b,transactions:()=>A,users:()=>w,wasteCollectionTasks:()=>R});var r=a(23733),l=a(95961),o=a(41401),s=a(12941),n=a(1575),i=a(72140),d=a(98748),u=a(28680);let c=(0,r.af)("users",{id:(0,l.eP)("id").primaryKey(),name:(0,o.L7)("name",{length:255}).notNull(),email:(0,o.L7)("email",{length:255}).notNull().unique(),password:(0,o.L7)("password",{length:255}),firebaseUid:(0,o.L7)("firebase_uid",{length:255}).unique(),authProvider:(0,o.L7)("auth_provider",{length:20}).default("email").notNull(),balance:(0,s._L)("balance").default(0).notNull(),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow(),image:(0,i.fL)("image"),publicProfileVisible:(0,d.O7)("public_profile_visible").default(!0).notNull(),profileSearchable:(0,d.O7)("profile_searchable").default(!0).notNull(),showRealName:(0,d.O7)("show_real_name").default(!1).notNull(),personalStatsVisible:(0,d.O7)("personal_stats_visible").default(!0).notNull(),dataSharing:(0,o.L7)("data_sharing",{length:20}).default("anonymous").notNull(),environmentalTracking:(0,d.O7)("environmental_tracking").default(!0).notNull(),collectionHistoryRetention:(0,o.L7)("collection_history_retention",{length:20}).default("1year").notNull()}),p=(0,r.af)("reports",{id:(0,l.eP)("id").primaryKey(),userId:(0,s._L)("user_id").references(()=>c.id),location:(0,i.fL)("location").notNull(),wasteType:(0,o.L7)("waste_type",{length:255}).notNull(),amount:(0,o.L7)("amount",{length:255}).notNull(),imageUrl:(0,i.fL)("image_url"),verificationResult:(0,u.JB)("verification_result"),status:(0,o.L7)("status",{length:255}).notNull().default("pending"),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),collectorId:(0,s._L)("collector_id").references(()=>c.id)}),m=(0,r.af)("rewards",{id:(0,l.eP)("id").primaryKey(),userId:(0,s._L)("user_id").references(()=>c.id).notNull(),points:(0,s._L)("points").notNull().default(0),level:(0,s._L)("level").notNull().default(1),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),updatedAt:(0,n.AB)("updated_at").defaultNow().notNull(),isAvailable:(0,d.O7)("is_available").notNull().default(!0),description:(0,i.fL)("description"),name:(0,o.L7)("name",{length:255}).notNull(),collectionInfo:(0,i.fL)("collection_info").notNull()}),f=(0,r.af)("collected_wastes",{id:(0,l.eP)("id").primaryKey(),reportId:(0,s._L)("report_id").references(()=>p.id).notNull(),collectorId:(0,s._L)("collector_id").references(()=>c.id).notNull(),collectionDate:(0,n.AB)("collection_date").notNull(),status:(0,o.L7)("status",{length:20}).notNull().default("collected"),amount:(0,o.L7)("amount",{length:255}),verificationResult:(0,u.JB)("verification_result")}),N=(0,r.af)("notifications",{id:(0,l.eP)("id").primaryKey(),userId:(0,s._L)("user_id").references(()=>c.id).notNull(),message:(0,i.fL)("message").notNull(),type:(0,o.L7)("type",{length:50}).notNull(),isRead:(0,d.O7)("is_read").notNull().default(!1),imageUrl:(0,i.fL)("image_url"),metadata:(0,u.JB)("metadata"),createdAt:(0,n.AB)("created_at").defaultNow().notNull()}),_=(0,r.af)("transactions",{id:(0,l.eP)("id").primaryKey(),userId:(0,s._L)("user_id").references(()=>c.id).notNull(),type:(0,o.L7)("type",{length:20}).notNull(),amount:(0,s._L)("amount").notNull(),description:(0,i.fL)("description").notNull(),date:(0,n.AB)("date").defaultNow().notNull()}),h=(0,r.af)("available_rewards",{id:(0,l.eP)("id").primaryKey(),name:(0,o.L7)("name",{length:255}).notNull(),description:(0,i.fL)("description"),points_required:(0,s._L)("points_required").notNull(),level_required:(0,s._L)("level_required").notNull(),created_at:(0,n.AB)("created_at").defaultNow().notNull(),updated_at:(0,n.AB)("updated_at").defaultNow().notNull()}),g=(0,r.af)("waste_collection_tasks",{id:(0,l.eP)("id").primaryKey(),createdBy:(0,s._L)("created_by").references(()=>c.id).notNull(),location:(0,i.fL)("location").notNull(),description:(0,i.fL)("description"),status:(0,o.L7)("status",{length:20}).default("active").notNull(),createdAt:(0,n.AB)("created_at").defaultNow().notNull(),completedAt:(0,n.AB)("completed_at")}),w=c,y=p,b=m,L=f,v=N,A=_,R=g},60938:(e,t,a)=>{a.d(t,{QX:()=>l,Sm:()=>o});var r=a(62315);function l(e){return(0,r.i6)`count(${e||r.i6.raw("*")})`.mapWith(Number)}function o(e){return(0,r.i6)`sum(${e})`.mapWith(String)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,7917],()=>a(49491));module.exports=r})();