"use strict";(()=>{var e={};e.id=7414,e.ids=[7414],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},31132:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>N,serverHooks:()=>b,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{GET:()=>m,dynamic:()=>p});var l=a(49303),o=a(88716),n=a(60670),s=a(87070),i=a(42633),d=a(48645),u=a(60938),c=a(57745);let p="force-dynamic";async function m(e){try{try{await i.db.select().from(d.Users).limit(1)}catch(e){return s.NextResponse.json({error:"Database connection failed",leaderboard:[],totalUsers:0},{status:500})}let e=await i.db.select().from(d.Users);if(e.length,0===e.length)return s.NextResponse.json({leaderboard:[],totalUsers:0,lastUpdated:new Date().toISOString(),message:"No users found in database"});let t=(await Promise.all(e.map(async(e,t)=>{try{let t=await i.db.select({count:(0,u.QX)()}).from(d.Reports).where((0,c.eq)(d.Reports.userId,e.id)),a=await i.db.select({count:(0,u.QX)()}).from(d.CollectedWastes).where((0,c.eq)(d.CollectedWastes.collectorId,e.id)),r=await i.db.select({total:(0,u.Sm)(d.Transactions.amount)}).from(d.Transactions).where((0,c.eq)(d.Transactions.userId,e.id)),l=t[0]?.count||0,o=a[0]?.count||0,n=r[0]?.total||0,s=e.balance||0,p=s+10*l+15*o;return{id:e.id,userName:e.name||"Anonymous",email:e.email,balance:s,reportsSubmitted:l,tasksCompleted:o,totalEarnings:n,score:p,badges:f(l,o,s)}}catch(t){return{id:e.id,userName:e.name||"Anonymous",email:e.email,balance:e.balance||0,reportsSubmitted:0,tasksCompleted:0,totalEarnings:0,score:e.balance||0,badges:f(0,0,e.balance||0)}}}))).sort((e,t)=>t.score!==e.score?t.score-e.score:t.reportsSubmitted!==e.reportsSubmitted?t.reportsSubmitted-e.reportsSubmitted:t.tasksCompleted!==e.tasksCompleted?t.tasksCompleted-e.tasksCompleted:t.balance-e.balance).map((e,t)=>({...e,rank:t+1}));t.slice(0,5).forEach(e=>console.log(`  ${e.rank}. ${e.userName} (Score: ${e.score})`));let a=s.NextResponse.json({leaderboard:t,totalUsers:t.length,lastUpdated:new Date().toISOString()});return a.headers.set("Cache-Control","no-store, no-cache, must-revalidate, proxy-revalidate"),a.headers.set("Pragma","no-cache"),a.headers.set("Expires","0"),a}catch(t){let e=t instanceof Error?t:Error(String(t));return s.NextResponse.json({error:"Failed to fetch leaderboard",details:e.message,leaderboard:[],totalUsers:0},{status:500})}}function f(e,t,a){let r=[];return e>=1&&r.push("\uD83C\uDFAF First Reporter"),e>=10&&r.push("⚔️ Waste Warrior"),e>=25&&r.push("\uD83C\uDF0D Environmental Guardian"),t>=5&&r.push("\uD83E\uDD1D Community Helper"),t>=20&&r.push("\uD83D\uDE9B Collection Expert"),a>=100&&r.push("\uD83D\uDCB0 Token Collector"),a>=500&&r.push("\uD83D\uDC8E Wealth Builder"),r}let N=new l.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/leaderboard/route",pathname:"/api/leaderboard",filename:"route",bundlePath:"app/api/leaderboard/route"},resolvedPagePath:"C:\\Users\\devan\\Downloads\\zero2hero-Waste-Management-System-master\\src\\app\\api\\leaderboard\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:_,serverHooks:b}=N,g="/api/leaderboard/route";function w(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:_})}},42633:(e,t,a)=>{a.d(t,{db:()=>s});var r=a(17917),l=a(62237),o=a(48645);let n=(0,l.qn)("postgresql://neondb_owner:Devansh%4077@ep-weathered-waterfall-a16ci7i1-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require"),s=(0,r.tS)(n,{schema:o})},48645:(e,t,a)=>{a.r(t),a.d(t,{CollectedWastes:()=>f,Notifications:()=>N,Reports:()=>p,Rewards:()=>m,Transactions:()=>h,Users:()=>c,WasteCollectionTasks:()=>b,available_rewards:()=>_,collectedWaste:()=>L,notifications:()=>v,reports:()=>w,rewards:()=>y,transactions:()=>A,users:()=>g,wasteCollectionTasks:()=>D});var r=a(23733),l=a(95961),o=a(41401),n=a(12941),s=a(1575),i=a(72140),d=a(98748),u=a(28680);let c=(0,r.af)("users",{id:(0,l.eP)("id").primaryKey(),name:(0,o.L7)("name",{length:255}).notNull(),email:(0,o.L7)("email",{length:255}).notNull().unique(),password:(0,o.L7)("password",{length:255}),firebaseUid:(0,o.L7)("firebase_uid",{length:255}).unique(),authProvider:(0,o.L7)("auth_provider",{length:20}).default("email").notNull(),balance:(0,n._L)("balance").default(0).notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow(),image:(0,i.fL)("image"),publicProfileVisible:(0,d.O7)("public_profile_visible").default(!0).notNull(),profileSearchable:(0,d.O7)("profile_searchable").default(!0).notNull(),showRealName:(0,d.O7)("show_real_name").default(!1).notNull(),personalStatsVisible:(0,d.O7)("personal_stats_visible").default(!0).notNull(),dataSharing:(0,o.L7)("data_sharing",{length:20}).default("anonymous").notNull(),environmentalTracking:(0,d.O7)("environmental_tracking").default(!0).notNull(),collectionHistoryRetention:(0,o.L7)("collection_history_retention",{length:20}).default("1year").notNull()}),p=(0,r.af)("reports",{id:(0,l.eP)("id").primaryKey(),userId:(0,n._L)("user_id").references(()=>c.id),location:(0,i.fL)("location").notNull(),wasteType:(0,o.L7)("waste_type",{length:255}).notNull(),amount:(0,o.L7)("amount",{length:255}).notNull(),imageUrl:(0,i.fL)("image_url"),verificationResult:(0,u.JB)("verification_result"),status:(0,o.L7)("status",{length:255}).notNull().default("pending"),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),collectorId:(0,n._L)("collector_id").references(()=>c.id)}),m=(0,r.af)("rewards",{id:(0,l.eP)("id").primaryKey(),userId:(0,n._L)("user_id").references(()=>c.id).notNull(),points:(0,n._L)("points").notNull().default(0),level:(0,n._L)("level").notNull().default(1),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull(),isAvailable:(0,d.O7)("is_available").notNull().default(!0),description:(0,i.fL)("description"),name:(0,o.L7)("name",{length:255}).notNull(),collectionInfo:(0,i.fL)("collection_info").notNull()}),f=(0,r.af)("collected_wastes",{id:(0,l.eP)("id").primaryKey(),reportId:(0,n._L)("report_id").references(()=>p.id).notNull(),collectorId:(0,n._L)("collector_id").references(()=>c.id).notNull(),collectionDate:(0,s.AB)("collection_date").notNull(),status:(0,o.L7)("status",{length:20}).notNull().default("collected"),amount:(0,o.L7)("amount",{length:255}),verificationResult:(0,u.JB)("verification_result")}),N=(0,r.af)("notifications",{id:(0,l.eP)("id").primaryKey(),userId:(0,n._L)("user_id").references(()=>c.id).notNull(),message:(0,i.fL)("message").notNull(),type:(0,o.L7)("type",{length:50}).notNull(),isRead:(0,d.O7)("is_read").notNull().default(!1),imageUrl:(0,i.fL)("image_url"),metadata:(0,u.JB)("metadata"),createdAt:(0,s.AB)("created_at").defaultNow().notNull()}),h=(0,r.af)("transactions",{id:(0,l.eP)("id").primaryKey(),userId:(0,n._L)("user_id").references(()=>c.id).notNull(),type:(0,o.L7)("type",{length:20}).notNull(),amount:(0,n._L)("amount").notNull(),description:(0,i.fL)("description").notNull(),date:(0,s.AB)("date").defaultNow().notNull()}),_=(0,r.af)("available_rewards",{id:(0,l.eP)("id").primaryKey(),name:(0,o.L7)("name",{length:255}).notNull(),description:(0,i.fL)("description"),points_required:(0,n._L)("points_required").notNull(),level_required:(0,n._L)("level_required").notNull(),created_at:(0,s.AB)("created_at").defaultNow().notNull(),updated_at:(0,s.AB)("updated_at").defaultNow().notNull()}),b=(0,r.af)("waste_collection_tasks",{id:(0,l.eP)("id").primaryKey(),createdBy:(0,n._L)("created_by").references(()=>c.id).notNull(),location:(0,i.fL)("location").notNull(),description:(0,i.fL)("description"),status:(0,o.L7)("status",{length:20}).default("active").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),completedAt:(0,s.AB)("completed_at")}),g=c,w=p,y=m,L=f,v=N,A=h,D=b},60938:(e,t,a)=>{a.d(t,{QX:()=>l,Sm:()=>o});var r=a(62315);function l(e){return(0,r.i6)`count(${e||r.i6.raw("*")})`.mapWith(Number)}function o(e){return(0,r.i6)`sum(${e})`.mapWith(String)}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,7917],()=>a(31132));module.exports=r})();